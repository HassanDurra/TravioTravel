@{
	Layout = "~/Views/Shared/_UserLayout.cshtml";
	ViewData["title"] = "Available Services";
}
<style>
    .error-message{
        display:none;
    }
</style>
<!--========================= PAGE-COVER ======================-->
<section class="page-cover back-size" id="cover-flight-grid-list">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1 class="page-title">@ViewData["title"]</h1>
                <ul class="breadcrumb">
                    <li ><a href="#">Home / &nbsp;</a></li>
                    <li>@ViewData["title"]</li>
                </ul>
            </div><!-- end columns -->
        </div><!-- end row -->
    </div><!-- end container -->
</section><!-- end page-cover -->
<section class="innerpage-wrapper">
    <div id="flight-listings" class="innerpage-section-padding">
        <div class="container">
            <div class="row">

                <!--These are the dynamic input field for data retreiving-->
                <input type="hidden"  id="from_city" name="from_city" value="@ViewBag.BookingDetails.from_city" />
                <input type="hidden" name="from_country" id="from_country" value="@ViewBag.BookingDetails.from_country" />
                <input type="hidden" name="to_city" id="to_city" value="@ViewBag.BookingDetails.to_city" />
                <input type="hidden" name="to_country" id="to_country" value="@ViewBag.BookingDetails.to_country" />
                <input type="hidden" name="departureDate" value="@ViewBag.BookingDetails.departureDate" />
                <input type="hidden" name="adults" value="@ViewBag.BookingDetails.adults" />
                <!--These are the dynamic input field for data retreiving-->


                <div class="col-12 col-md-12 col-lg-3 side-bar left-side-bar">

                    <div class="side-bar-block filter-block">
                        <h3>Sort By Filter</h3>
                        <p>Find your dream flights today</p>

                        <div class="panels-group">

                            <div class="card">
                                <div class="card-header">
                                    <a href="#panel-1" data-bs-toggle="collapse">Select Airline <span><i class="fa fa-angle-down"></i></span></a>
                                </div><!-- end card-header -->

                                <div id="panel-1" class="panel-collapse collapse">
                                    <div class="card-body text-start">
                                        <ul class="list-unstyled" id="airlinesList">
                                            <li class="custom-check">
                                                <input type="checkbox" id="check01" name="checkbox" />
                                                <label for="check01"><span><i class="fa fa-check"></i></span>All Types</label>
                                            </li>
                                          
                                        </ul>
                                    </div><!-- end card-body -->
                                </div><!-- end panel-collapse -->
                            </div><!-- end panel-default -->

                            <div class="card">
                                <div class="card-header">
                                    <a href="#panel-2" data-bs-toggle="collapse">Flight Class <span><i class="fa fa-angle-down"></i></span></a>
                                </div><!-- end card-header -->

                                <div id="panel-2" class="panel-collapse collapse">
                                    <div class="card-body text-start">
                                        <ul class="list-unstyled">
                                            <li class="custom-check">
                                                <input type="checkbox" id="check10" name="checkbox" />
                                                <label for="check10"><span><i class="fa fa-check"></i></span>All</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check11" name="checkbox" />
                                                <label for="check11"><span><i class="fa fa-check"></i></span>Economy</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check12" name="checkbox" />
                                                <label for="check12"><span><i class="fa fa-check"></i></span>First Class</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check13" name="checkbox" />
                                                <label for="check13"><span><i class="fa fa-check"></i></span>Business</label>
                                            </li>
                                        </ul>
                                    </div><!-- end card-body -->
                                </div><!-- end panel-collapse -->
                            </div><!-- end panel-default -->

                            <div class="card">
                                <div class="card-header">
                                    <a href="#panel-3" data-bs-toggle="collapse">Flight Stops <span><i class="fa fa-angle-down"></i></span></a>
                                </div><!-- end card-header -->

                                <div id="panel-3" class="panel-collapse collapse">
                                    <div class="card-body text-start">
                                        <ul class="list-unstyled">
                                            <li class="custom-check">
                                                <input type="checkbox" id="check14" name="checkbox" />
                                                <label for="check14"><span><i class="fa fa-check"></i></span>All</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check15" name="checkbox" />
                                                <label for="check15"><span><i class="fa fa-check"></i></span>1 Stop</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check16" name="checkbox" />
                                                <label for="check16"><span><i class="fa fa-check"></i></span>2 Stop</label>
                                            </li>
                                            <li class="custom-check">
                                                <input type="checkbox" id="check17" name="checkbox" />
                                                <label for="check17"><span><i class="fa fa-check"></i></span>3 Stop</label>
                                            </li>
                                        </ul>
                                    </div><!-- end card-body -->
                                </div><!-- end panel-collapse -->
                            </div><!-- end panel-default -->

                        </div><!-- end panel-group -->

                        <div class="price-slider">
                            <p><input type="text" id="amount" readonly></p>
                            <div id="slider-range"></div>
                        </div><!-- end price-slider -->
                    </div><!-- end side-bar-block -->

                    <div class="row">
                        <div class="col-12 col-md-6 col-lg-12">
                            <div class="side-bar-block main-block ad-block">
                                <div class="main-img ad-img">
                                    <a href="#">
                                        <img src="~/userassets/images/car-ad.jpg" class="img-fluid" alt="car-ad" />
                                        <div class="ad-mask">
                                            <div class="ad-text">
                                                <span>Luxury</span>
                                                <h2>Car</h2>
                                                <span>Offer</span>
                                            </div><!-- end ad-text -->
                                        </div><!-- end columns -->
                                    </a>
                                </div><!-- end ad-img -->
                            </div><!-- end side-bar-block -->
                        </div><!-- end columns -->

                        <div class="col-12 col-md-6 col-lg-12">
                            <div class="side-bar-block support-block">
                                <h3>Need Help</h3>
                                <p>Lorem ipsum dolor sit amet, ad duo fugit aeque fabulas, in lucilius prodesset pri. Veniam delectus ei vis. Est atqui timeam mnesarchum.</p>
                                <div class="support-contact">
                                    <span><i class="fa fa-phone"></i></span>
                                    <p>+1 123 1234567</p>
                                </div><!-- end support-contact -->
                            </div><!-- end side-bar-block -->
                        </div><!-- end columns -->

                    </div><!-- end row -->

                </div><!-- end columns -->

                <div class="col-12 col-md-12 col-lg-9 content-side position-relative " id="serviceContainer">
                    
                            <div class="container" id="searchingLoader" style="position: absolute; top: 30%; left: 50%;transform: translate(-50%  , -50%);">
                                <center><img src="~/userassets/images/loader.svg" alt=""></center>
                                <br>
                                <center><h1>Searching Flights</h1></center>
                            </div>

                    <div class="error-message">
                        <center>
                            <img src="~/userassets/images/magnifying-glass.png" alt="">
                            <h1>No Flights Found</h1>
                        </center>
                    </div>
                  

                </div><!-- end columns -->
                <div class="col-md-12">    <center><button id="load-more"  class="btn  btn-warning w-100 p-3 text-white"><i class="fa fa-undo"></i>&nbsp;  Load More</button></center></div>

            </div><!-- end row -->
        </div><!-- end container -->
    </div><!-- end flight-listings -->
</section><!-- end innerpage-wrapper -->
<script src="~/userassets/js/jquery-3.3.1.min.js"></script>


<script>

    let getIataCode      = '@Url.Action("getAirportsIata" , "BookingRequest")';
    let getAirlines      = '@Url.Action("getAirlinesService", "BookingRequest")';
    let FlightBookingUrl = '@Url.Action("FlightBooking", "Booking")';
    let currencySymbolurl = '@Url.Action("checkCurrency" , "Booking")';
    $(document).ready(function (e) {
        let errorContainer    = $('.error-message');
        let serviceContainer = $('#serviceContainer');
        let searchingLoader = $('#searchingLoader');
        let from_city = $('#from_city');
        let to_city = $('#to_city');
        let fromCountries = $("#from_country");
        let toCountries = $("#to_country");
        let departureDate = $('input[name="departureDate"]');
        let numberofAdults = $('input[name="adults"]');
        let airlineList =   $('#airlinesList');
        // Sending Data to our getIata function to retrieve IATA CODE OF AIRPORTS
        // Converting Date Format From dd/mm/yyy To YYYYMMDD for api
        const DatePart = departureDate.val().split('/'); // This Will Remove the / from the values
        const month = DatePart[0];
        const date = DatePart[1];
        const year = DatePart[2];
        const formattedMonth = String(month).padStart(2, '0');
        const formattedDate = String(date).padStart(2, '0');
        let formattedDeparture = `${year}-${formattedMonth}-${formattedDate}`;
      

        // End Of Converting Date Format
        $.ajax({
            url: getIataCode,
            type: 'post',
            data: { fromCity: from_city.val(), toCity: to_city.val(), from_country: fromCountries.val(), to_country: toCountries.val() },
            success: function (response) {
                if (response.message == "FromCountry") {
                    let fromCountry = response.fromCountryDetails.iataCode;
                    let fromCountryName = response.fromCountryDetails.city_name;
                    let toCity          = response.toCityDetails.iataCode;
                    let toCityName      = response.toCityDetails.city_name;
                    // First we Will Authorize our self to Amadeus.com then we can get a generated access token for api product usage
                    //Authorizing
                    var tokenUrl = "https://test.api.amadeus.com/v1/security/oauth2/token";
                    // Amadeus Client Credientals
                    const clientid = "gOIqKp00iu9rGRDRb893Mwa6YgagLRLz"; //Your App Api Key
                    const clientSecret = "86nyQTrv9AF5SkU4"; // Api Secret Key
                    //Creating A Data Variable to send these credentials
                    const requestData = {
                        grant_type: 'client_credentials',
                        client_id: clientid,
                        client_secret: clientSecret
                    };
                    //Converting Data Request to A url-encode String
                    const requestDataString = Object.keys(requestData).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(requestData[key])).join('&');
                    let itemsPerPage = 10;
                    let page = 1; // Page number
                    // Now Sending Ajax Request
                    let cardContainer = "";
                    function loadData() {
                        $.ajax({
                            url: tokenUrl,
                            method: 'Post',
                            data: requestDataString,
                            success: function (clientData) {
                                const apiUrl = 'https://test.api.amadeus.com/v2/shopping/flight-offers'; // The Api Service You Want Use
                                const accessToken = clientData.access_token; // This Is mendatory to authorize user to use the api service
                                const SearchParams = {

                                    originLocationCode: fromCountry,
                                    destinationLocationCode: toCity,
                                    departureDate: formattedDeparture,// Date Format YYYY-MM-DD
                                    adults: numberofAdults.val()
                                }; // these are the params that we will send to our flight search api
                                const requestDataString = Object.keys(SearchParams).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(SearchParams[key])).join('&');
                                // Now Our Date And Uri is ready we will create a ajax Get request to send data and get data from response
                                $.ajax({
                                    url: apiUrl + '?' + requestDataString,
                                    method: "Get",
                                    headers: {
                                        'Authorization': 'Bearer ' + accessToken,
                                    },
                                    success: function (response) {
                                        if (response.data == "" || response.data == null) {
                                            Swal.fire({
                                                title: 'We Are Sorry!',
                                                text: 'No flights found!',
                                                icon: 'error',
                                                confirmButtonText: 'Close it!'
                                            });
                                            $(searchingLoader).fadeOut();
                                            $(errorContainer).fadeIn();
                                            $("#load-more").hide();
                                            return false;
                                        }
                                        else {
                                            let uniqueAirlinesIata = [];
                                            let segementArray = [];
                                            let airlineContainer = "";

                                            $.each(response.dictionaries.carriers, function (index, carriers) {
                                                airlineContainer += `
                                                            <li class="custom-check">
                                                                            <input type="checkbox" id="check${index}" name="checkbox" value="${carriers}"/>
                                                                        <label for="check${index}"><span><i class="fa fa-check"></i></span>${carriers}</label>
                                                            </li>`;
                                            });
                                            // Assuming 'response' is the JSON response object

                                            var airlineData = [];
                                            const startIndex = (page - 1) * itemsPerPage;

                                            const endIndex = startIndex + itemsPerPage;

                                            const itemsToDisplay = response.data.slice(startIndex, endIndex);

                                            if (itemsToDisplay.length >= 10) {
                                                $("#load-more").show();
                                                $("#load-more").prop("disabled", false);
                                            }
                                            else {
                                                $("#load-more").hide();
                                            }


                                            $(itemsToDisplay).each(function (index, value) {

                                                $(value.validatingAirlineCodes).each(function (a, airlineCode) {
                                                    var airlineCodes = [];
                                                    airlineCodes.push(airlineCode);

                                                    $(value.itineraries).each(function (i, itinerary) {





                                                        var durationValue = itinerary.duration;
                                                        var hour = durationValue.match(/(\d+)H/);
                                                        var minutes = durationValue.match(/(\d+)M/);
                                                        if (hour && minutes) {
                                                            var FormattedDuration = hour[1] + "hours" + "-" + minutes[1] + "minutes";
                                                        }
                                                        var segment = itinerary.segments;
                                                       
                                                        $(value.travelerPricings).each(function (j, pricing) {
                                                            for (let s = 0; s < itinerary.segments.length; s++) {




                                                                // Changing Arrival And Departure Format from yyyy-mm-dd 00-00 to mm-dd-yyyy
                                                                var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                                                //Departure Format
                                                                var DepartureDate = segment[s].departure.at;
                                                                var dept_date = new Date(DepartureDate);
                                                                var d_year = dept_date.getFullYear();
                                                                var d_month = dept_date.getMonth();
                                                                var d_date = dept_date.getDate();
                                                                var d_hour = dept_date.getHours();
                                                                var d_minutes = dept_date.getMinutes();
                                                                var FormattedDepatures = months[d_month] + ", " + d_date + "-" + d_year + "(" + d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour < 12 ? "AM" : "PM") + ")"; //  // for example Aug, 02-2017 (8:40 PM)
                                                                // Arrival Format
                                                                var segmentLast = segment.splice(-1);
                                                                var ArrivalDate = segmentLast[s].arrival.at;

                                                                var arr_date = new Date(ArrivalDate);

                                                                var a_year = arr_date.getFullYear();
                                                                var a_month = arr_date.getMonth();
                                                                var a_date = arr_date.getDate();
                                                                var a_hour = arr_date.getHours();
                                                                var a_minutes = arr_date.getMinutes();
                                                            
                                                                var a_hour_12_format = a_hour % 12;
                                                                a_hour_12_format = a_hour_12_format ? a_hour_12_format : 12; // the hour '0' should be '12'
                                                                var FormattedArrival = months[a_month] + ", " + a_date + "-" + a_year + "(" + a_hour_12_format + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "PM" : "AM") + ")";
                                                                var wayType = "";
                                                                var stayType = "";
                                                                if (value.oneWay == false) {
                                                                    wayType = "Two Way";
                                                                    stayType = "2 Stay";
                                                                }
                                                                else {
                                                                    wayType = "One Way";
                                                                    stayType = "1 Stay";
                                                                }
                                                                var airlineData = {};


                                                                $.ajax({
                                                                    url: getAirlines,
                                                                    method: "Post",
                                                                    data: { AirlinesIata: airlineCodes },
                                                                    success: function (airlines) {
                                                                        var airlineInfo = {};

                                                                        $(airlines).each(function (ar, airline) {
                                                                            var departure_date = months[d_month] + ", " + d_date + "-" + d_year;
                                                                            var departure_time = d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour >= 12 ? "AM" : "PM");
                                                                            var arrival_date = months[a_month] + ", " + a_date + "-" + a_year;
                                                                            var arrival_time = a_hour + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "AM" : "PM");

                                                                            cardContainer += `
                                                                                     <div class="list-block main-block f-list-block">
                                                                                <div class="list-content">
                                                                                    <div class="main-img list-img f-list-img">
                                                                                        <a href="flight-detail-left-sidebar.html">
                                                                                            <div class="f-img">
                                                                                                        <img src="${airline.airlineImage}" class="img-fluid" alt="flight-img" />
                                                                                            </div><!-- end f-list-img -->
                                                                                        </a>
                                                                                        <ul class="list-unstyled list-inline offer-price-1">
                                                                                            <li class="list-inline-item duration"><i class="fa fa-clock-o"></i><span>${FormattedDuration}</span></li>
                                                                                                    <li class="list-inline-item price"><div class="currencyContainer"></div>${pricing.price.total}<span class="divider">|</span><span class="pkg">${stayType}</span></li>
                                                                                        </ul>
                                                                                        <ul class="list-unstyled flight-timing">
                                                                                                <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedDepatures}</li>
                                                                                                    <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedArrival}</li>
                                                                                        </ul>
                                                                                    </div><!-- end f-list-img -->

                                                                                    <div class="list-info f-list-info">
                                                                                                        <h3 class="block-title"><a href="flight-detail-left-sidebar.html">${fromCountryName} to ${toCityName}</a></h3>
                                                                                        <p class="block-minor"><span>Fr 5379,</span> ${wayType} Flight</p>
                                                                                        <p>Lorem ipsum dolor sit amet, ad duo fugit aeque fabulas, in lucilius prodesset pri. Veniam delectus ei vis. Est atqui timeam mnesarchum at, pro an eros perpetua ullamcorper.</p>

                                                                                            <form id="bookingFormDetails">
                                                                                                    <input type ="hidden" name="airline_name" value="${airline.airlinename}" />
                                                                                                    <input type ="hidden" name="airline_image" value="${airline.airlineImage}" />
                                                                                                            <input type ="hidden" name="aircraft_code" value="${segmentLast[s].aircraft.code}" />
                                                                                                    <input type ="hidden" name="duration" value="${FormattedDuration}" />
                                                                                                    <input type ="hidden" name="journey_type" value="${wayType}" />
                                                                                                    <input type ="hidden" name="departure_date" value="${departure_date}" />
                                                                                                    <input type ="hidden" name="departure_time" value="${departure_time}" />
                                                                                                    <input type ="hidden" name="arrival_date" value="${arrival_date}" />
                                                                                                    <input type ="hidden" name="arrival_time" value="${arrival_time}" />
                                                                                                            <input type ="hidden" name="from" value="${fromCountryName}" />
                                                                                                    <input type ="hidden" name="to" value="${toCityName}" />
                                                                                                    <input type="hidden"  name="adults" value="${numberofAdults.val()}" />
                                                                                                    <input type="hidden"  name="currency" value="${pricing.price.currency}" />
                                                                                                    <input type="hidden"  name="price" value="${pricing.price.total}" />
                                                                                                    <input type="hidden"  name="class_type" value="${pricing.fareDetailsBySegment[0].class}" />
                                                                                                    <input type="hidden"  name="class_name" value="${pricing.fareDetailsBySegment[0].cabin}" />

                                                                                            <button type="submit" class="btn btn-orange ticket_booking">Book Ticket</button>
                                                                                                </form>
                                                                                    </div><!-- end f-list-info -->
                                                                                </div><!-- end list-content -->
                                                                            </div><!-- end f-list-block -->`;
                                                                        });
                                                                        $(serviceContainer).html(cardContainer);
                                                                        $(airlineList).html(airlineContainer);
                                                                    }
                                                                });

                                                            }; //  Segemnts Ends Here
                                                        });  // Pricing Foreach Ends here
                                                    }); // Foreach Ends here

                                                }); // Foreach For Carrier Codes

                                            });// duration each function



                                        }

                                    }


                                });
                                $(document).on('click', '.ticket_booking', function (e) {
                                    e.preventDefault();
                                    var formData = {
                                        aircraftCode: $(this).closest('#bookingFormDetails').find('input[name="aircraft_code"]').val(),
                                        airlineName: $(this).closest('#bookingFormDetails').find('input[name="airline_name"]').val(),
                                        airlineImage: $(this).closest('#bookingFormDetails').find('input[name="airline_image"]').val(),
                                        duration: $(this).closest('#bookingFormDetails').find('input[name="duration"]').val(),
                                        departureTime: $(this).closest('#bookingFormDetails').find('input[name="departure_time"]').val(),
                                        departureDate: $(this).closest('#bookingFormDetails').find('input[name="departure_date"]').val(),
                                        arrivalTime: $(this).closest('#bookingFormDetails').find('input[name="arrival_time"]').val(),
                                        arrivalDate: $(this).closest('#bookingFormDetails').find('input[name="arrival_date"]').val(),
                                        class_name: $(this).closest('#bookingFormDetails').find('input[name="class_name"]').val(),
                                        class_type: $(this).closest('#bookingFormDetails').find('input[name="class_type"]').val(),
                                        from: $(this).closest('#bookingFormDetails').find('input[name="from"]').val(),
                                        to: $(this).closest('#bookingFormDetails').find('input[name="to"]').val(),
                                        number_of_adults: $(this).closest('#bookingFormDetails').find('input[name="adults"]').val(),
                                        journey_type: $(this).closest('#bookingFormDetails').find('input[name="journey_type"]').val(),
                                        price: $(this).closest('#bookingFormDetails').find('input[name="price"]').val(),
                                        currency: $(this).closest('#bookingFormDetails').find('input[name="currency"]').val()
                                    };

                                    window.location.href = FlightBookingUrl + '?FlightDetails=' + JSON.stringify(formData);
                                });
                            }

                        });

                    }
                    loadData();
                    $('#load-more').click(function () {


                        page++; // Increment the page number
                        cardContainer = ""; // Clear the cardContainer before loading more data
                        loadData();


                    });


                }
                /// ============== ///
                if (response.message == "FromCountryAndCity") {
                    let fromCountry = response.fromCountryDetails.iataCode;
                    let fromCountryName = response.fromCountryDetails.city_name;
                    let toCity = response.toCountry.iataCode;
                    let toCityName = response.toCountry.city_name;
                    // First we Will Authorize our self to Amadeus.com then we can get a generated access token for api product usage
                    //Authorizing
                    var tokenUrl = "https://test.api.amadeus.com/v1/security/oauth2/token";
                    // Amadeus Client Credientals
                    const clientid = "gOIqKp00iu9rGRDRb893Mwa6YgagLRLz"; //Your App Api Key
                    const clientSecret = "86nyQTrv9AF5SkU4"; // Api Secret Key
                    //Creating A Data Variable to send these credentials
                    const requestData = {
                        grant_type: 'client_credentials',
                        client_id: clientid,
                        client_secret: clientSecret
                    };
                    //Converting Data Request to A url-encode String
                    const requestDataString = Object.keys(requestData).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(requestData[key])).join('&');
                    let itemsPerPage = 10;
                    let page = 1; // Page number
                    // Now Sending Ajax Request
                    let cardContainer = "";
                    function loadData() {
                        $.ajax({
                            url: tokenUrl,
                            method: 'Post',
                            data: requestDataString,
                            success: function (clientData) {
                                const apiUrl = 'https://test.api.amadeus.com/v2/shopping/flight-offers'; // The Api Service You Want Use
                                const accessToken = clientData.access_token; // This Is mendatory to authorize user to use the api service
                                const SearchParams = {

                                    originLocationCode: fromCountry,
                                    destinationLocationCode: toCity,
                                    departureDate: formattedDeparture,// Date Format YYYY-MM-DD
                                    adults: numberofAdults.val()
                                }; // these are the params that we will send to our flight search api
                                const requestDataString = Object.keys(SearchParams).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(SearchParams[key])).join('&');
                                // Now Our Date And Uri is ready we will create a ajax Get request to send data and get data from response
                                $.ajax({
                                    url: apiUrl + '?' + requestDataString,
                                    method: "Get",
                                    headers: {
                                        'Authorization': 'Bearer ' + accessToken,
                                    },
                                    success: function (response) {
                                        if (response.data == "" || response.data == null) {
                                            Swal.fire({
                                                title: 'We Are Sorry!',
                                                text: 'No flights found!',
                                                icon: 'error',
                                                confirmButtonText: 'Close it!'
                                            });
                                            $(searchingLoader).fadeOut();
                                            $(errorContainer).fadeIn();
                                            $("#load-more").hide();
                                            return false;
                                        }
                                        else {
                                            let uniqueAirlinesIata = [];
                                            let segementArray = [];
                                            let airlineContainer = "";

                                            $.each(response.dictionaries.carriers, function (index, carriers) {
                                                airlineContainer += `
                                                        <li class="custom-check">
                                                                        <input type="checkbox" id="check${index}" name="checkbox" value="${carriers}"/>
                                                                    <label for="check${index}"><span><i class="fa fa-check"></i></span>${carriers}</label>
                                                        </li>`;
                                            });
                                            // Assuming 'response' is the JSON response object

                                            var airlineData = [];
                                            const startIndex = (page - 1) * itemsPerPage;

                                            const endIndex = startIndex + itemsPerPage;

                                            const itemsToDisplay = response.data.slice(startIndex, endIndex);

                                            if (itemsToDisplay.length >= 10) {
                                                $("#load-more").show();
                                                $("#load-more").prop("disabled", false);
                                            }
                                            else {
                                                $("#load-more").hide();
                                            }


                                            $(itemsToDisplay).each(function (index, value) {

                                                $(value.validatingAirlineCodes).each(function (a, airlineCode) {
                                                    var airlineCodes = [];
                                                    airlineCodes.push(airlineCode);

                                                    $(value.itineraries).each(function (i, itinerary) {





                                                        var durationValue = itinerary.duration;
                                                        var hour = durationValue.match(/(\d+)H/);
                                                        var minutes = durationValue.match(/(\d+)M/);
                                                        if (hour && minutes) {
                                                            var FormattedDuration = hour[1] + "hours" + "-" + minutes[1] + "minutes";
                                                        }
                                                        var segment = itinerary.segments;
                                                      
                                                        $(value.travelerPricings).each(function (j, pricing) {
                                                            for (let s = 0; s < itinerary.segments.length; s++) {




                                                                // Changing Arrival And Departure Format from yyyy-mm-dd 00-00 to mm-dd-yyyy
                                                                var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                                                //Departure Format
                                                                var DepartureDate = segment[s].departure.at;
                                                                var dept_date = new Date(DepartureDate);
                                                                var d_year = dept_date.getFullYear();
                                                                var d_month = dept_date.getMonth();
                                                                var d_date = dept_date.getDate();
                                                                var d_hour = dept_date.getHours();
                                                                var d_minutes = dept_date.getMinutes();
                                                                var FormattedDepatures = months[d_month] + ", " + d_date + "-" + d_year + "(" + d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour < 12 ? "AM" : "PM") + ")"; //  // for example Aug, 02-2017 (8:40 PM)
                                                                // Arrival Format
                                                                var segmentLast = segment.splice(-1);
                                                                var ArrivalDate = segmentLast[s].arrival.at;

                                                                var arr_date = new Date(ArrivalDate);

                                                                var a_year = arr_date.getFullYear();
                                                                var a_month = arr_date.getMonth();
                                                                var a_date = arr_date.getDate();
                                                                var a_hour = arr_date.getHours();
                                                                var a_minutes = arr_date.getMinutes();
                                                              
                                                                var a_hour_12_format = a_hour % 12;
                                                                a_hour_12_format = a_hour_12_format ? a_hour_12_format : 12; // the hour '0' should be '12'
                                                                var FormattedArrival = months[a_month] + ", " + a_date + "-" + a_year + "(" + a_hour_12_format + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "PM" : "AM") + ")";
                                                                var wayType = "";
                                                                var stayType = "";
                                                                if (value.oneWay == false) {
                                                                    wayType = "Two Way";
                                                                    stayType = "2 Stay";
                                                                }
                                                                else {
                                                                    wayType = "One Way";
                                                                    stayType = "1 Stay";
                                                                }
                                                                var airlineData = {};


                                                                $.ajax({
                                                                    url: getAirlines,
                                                                    method: "Post",
                                                                    data: { AirlinesIata: airlineCodes },
                                                                    success: function (airlines) {
                                                                        var airlineInfo = {};

                                                                        $(airlines).each(function (ar, airline) {
                                                                            var departure_date = months[d_month] + ", " + d_date + "-" + d_year;
                                                                            var departure_time = d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour >= 12 ? "AM" : "PM");
                                                                            var arrival_date = months[a_month] + ", " + a_date + "-" + a_year;
                                                                            var arrival_time = a_hour + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "AM" : "PM");

                                                                            cardContainer += `
                                                                                 <div class="list-block main-block f-list-block">
                                                                            <div class="list-content">
                                                                                <div class="main-img list-img f-list-img">
                                                                                    <a href="flight-detail-left-sidebar.html">
                                                                                        <div class="f-img">
                                                                                                    <img src="${airline.airlineImage}" class="img-fluid" alt="flight-img" />
                                                                                        </div><!-- end f-list-img -->
                                                                                    </a>
                                                                                    <ul class="list-unstyled list-inline offer-price-1">
                                                                                        <li class="list-inline-item duration"><i class="fa fa-clock-o"></i><span>${FormattedDuration}</span></li>
                                                                                                <li class="list-inline-item price"><div class="currencyContainer"></div>${pricing.price.total}<span class="divider">|</span><span class="pkg">${stayType}</span></li>
                                                                                    </ul>
                                                                                    <ul class="list-unstyled flight-timing">
                                                                                            <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedDepatures}</li>
                                                                                                <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedArrival}</li>
                                                                                    </ul>
                                                                                </div><!-- end f-list-img -->

                                                                                <div class="list-info f-list-info">
                                                                                                    <h3 class="block-title"><a href="flight-detail-left-sidebar.html">${fromCountryName} to ${toCityName}</a></h3>
                                                                                    <p class="block-minor"><span>Fr 5379,</span> ${wayType} Flight</p>
                                                                                    <p>Lorem ipsum dolor sit amet, ad duo fugit aeque fabulas, in lucilius prodesset pri. Veniam delectus ei vis. Est atqui timeam mnesarchum at, pro an eros perpetua ullamcorper.</p>

                                                                                        <form id="bookingFormDetails">
                                                                                                <input type ="hidden" name="airline_name" value="${airline.airlinename}" />
                                                                                                <input type ="hidden" name="airline_image" value="${airline.airlineImage}" />
                                                                                                        <input type ="hidden" name="aircraft_code" value="${segmentLast[s].aircraft.code}" />
                                                                                                <input type ="hidden" name="duration" value="${FormattedDuration}" />
                                                                                                <input type ="hidden" name="journey_type" value="${wayType}" />
                                                                                                <input type ="hidden" name="departure_date" value="${departure_date}" />
                                                                                                <input type ="hidden" name="departure_time" value="${departure_time}" />
                                                                                                <input type ="hidden" name="arrival_date" value="${arrival_date}" />
                                                                                                <input type ="hidden" name="arrival_time" value="${arrival_time}" />
                                                                                                        <input type ="hidden" name="from" value="${fromCountryName}" />
                                                                                                <input type ="hidden" name="to" value="${toCityName}" />
                                                                                                <input type="hidden"  name="adults" value="${numberofAdults.val()}" />
                                                                                                <input type="hidden"  name="currency" value="${pricing.price.currency}" />
                                                                                                <input type="hidden"  name="price" value="${pricing.price.total}" />
                                                                                                <input type="hidden"  name="class_type" value="${pricing.fareDetailsBySegment[0].class}" />
                                                                                                <input type="hidden"  name="class_name" value="${pricing.fareDetailsBySegment[0].cabin}" />

                                                                                        <button type="submit" class="btn btn-orange ticket_booking">Book Ticket</button>
                                                                                            </form>
                                                                                </div><!-- end f-list-info -->
                                                                            </div><!-- end list-content -->
                                                                        </div><!-- end f-list-block -->`;
                                                                        });
                                                                        $(serviceContainer).html(cardContainer);
                                                                        $(airlineList).html(airlineContainer);
                                                                    }
                                                                });

                                                            }; //  Segemnts Ends Here
                                                        });  // Pricing Foreach Ends here
                                                    }); // Foreach Ends here

                                                }); // Foreach For Carrier Codes

                                            });// duration each function



                                        }

                                    }


                                });
                                $(document).on('click', '.ticket_booking', function (e) {
                                    e.preventDefault();
                                    var formData = {
                                        aircraftCode: $(this).closest('#bookingFormDetails').find('input[name="aircraft_code"]').val(),
                                        airlineName: $(this).closest('#bookingFormDetails').find('input[name="airline_name"]').val(),
                                        airlineImage: $(this).closest('#bookingFormDetails').find('input[name="airline_image"]').val(),
                                        duration: $(this).closest('#bookingFormDetails').find('input[name="duration"]').val(),
                                        departureTime: $(this).closest('#bookingFormDetails').find('input[name="departure_time"]').val(),
                                        departureDate: $(this).closest('#bookingFormDetails').find('input[name="departure_date"]').val(),
                                        arrivalTime: $(this).closest('#bookingFormDetails').find('input[name="arrival_time"]').val(),
                                        arrivalDate: $(this).closest('#bookingFormDetails').find('input[name="arrival_date"]').val(),
                                        class_name: $(this).closest('#bookingFormDetails').find('input[name="class_name"]').val(),
                                        class_type: $(this).closest('#bookingFormDetails').find('input[name="class_type"]').val(),
                                        from: $(this).closest('#bookingFormDetails').find('input[name="from"]').val(),
                                        to: $(this).closest('#bookingFormDetails').find('input[name="to"]').val(),
                                        number_of_adults: $(this).closest('#bookingFormDetails').find('input[name="adults"]').val(),
                                        journey_type: $(this).closest('#bookingFormDetails').find('input[name="journey_type"]').val(),
                                        price: $(this).closest('#bookingFormDetails').find('input[name="price"]').val(),
                                        currency: $(this).closest('#bookingFormDetails').find('input[name="currency"]').val()
                                    };

                                    window.location.href = FlightBookingUrl + '?FlightDetails=' + JSON.stringify(formData);
                                });
                            }

                        });

                    }
                    loadData();
                    $('#load-more').click(function () {


                        page++; // Increment the page number
                        cardContainer = ""; // Clear the cardContainer before loading more data
                        loadData();


                    });

                }
                ///----------------./////////
                else if (response.message == "toCountry") {
                    let FromCity = response.fromCityDetails.iataCode;
                    let FromCityName = response.fromCityDetails.city_name;
                    let toCountry = response.toCountry.iataCode;
                    let toCountryName = response.toCountry.city_name;
                    // First we Will Authorize our self to Amadeus.com then we can get a generated access token for api product usage
                    //Authorizing
                    var tokenUrl = "https://test.api.amadeus.com/v1/security/oauth2/token";
                    // Amadeus Client Credientals
                    const clientid = "gOIqKp00iu9rGRDRb893Mwa6YgagLRLz"; //Your App Api Key
                    const clientSecret = "86nyQTrv9AF5SkU4"; // Api Secret Key
                    //Creating A Data Variable to send these credentials
                    const requestData = {
                        grant_type: 'client_credentials',
                        client_id: clientid,
                        client_secret: clientSecret
                    };
                    //Converting Data Request to A url-encode String
                    const requestDataString = Object.keys(requestData).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(requestData[key])).join('&');
                    let itemsPerPage = 10;
                    let page = 1; // Page number
                    // Now Sending Ajax Request
                    let cardContainer = "";
                    function loadData() {
                        $.ajax({
                            url: tokenUrl,
                            method: 'Post',
                            data: requestDataString,
                            success: function (clientData) {
                                const apiUrl = 'https://test.api.amadeus.com/v2/shopping/flight-offers'; // The Api Service You Want Use
                                const accessToken = clientData.access_token; // This Is mendatory to authorize user to use the api service
                                const SearchParams = {

                                    originLocationCode: FromCity,
                                    destinationLocationCode: toCountry,
                                    departureDate: formattedDeparture,// Date Format YYYY-MM-DD
                                    adults: numberofAdults.val()
                                }; // these are the params that we will send to our flight search api
                                const requestDataString = Object.keys(SearchParams).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(SearchParams[key])).join('&');
                                // Now Our Date And Uri is ready we will create a ajax Get request to send data and get data from response
                                $.ajax({
                                    url: apiUrl + '?' + requestDataString,
                                    method: "Get",
                                    headers: {
                                        'Authorization': 'Bearer ' + accessToken,
                                    },
                                    success: function (response) {
                                        if (response.data == "" || response.data == null) {
                                            Swal.fire({
                                                title: 'We Are Sorry!',
                                                text: 'No flights found!',
                                                icon: 'error',
                                                confirmButtonText: 'Close it!'
                                            });
                                            $(searchingLoader).fadeOut();
                                            $(errorContainer).fadeIn();
                                            $("#load-more").hide();
                                            return false;
                                        }
                                        else {
                                            let uniqueAirlinesIata = [];
                                            let segementArray = [];
                                            let airlineContainer = "";

                                            $.each(response.dictionaries.carriers, function (index, carriers) {
                                                airlineContainer += `
                                                    <li class="custom-check">
                                                                    <input type="checkbox" id="check${index}" name="checkbox" value="${carriers}"/>
                                                                <label for="check${index}"><span><i class="fa fa-check"></i></span>${carriers}</label>
                                                    </li>`;
                                            });
                                            // Assuming 'response' is the JSON response object

                                            var airlineData = [];
                                            const startIndex = (page - 1) * itemsPerPage;

                                            const endIndex = startIndex + itemsPerPage;

                                            const itemsToDisplay = response.data.slice(startIndex, endIndex);
                                            
                                            if (itemsToDisplay.length >= 10) {
                                                $("#load-more").show();
                                                $("#load-more").prop("disabled", false);
                                            }
                                            else {
                                                $("#load-more").hide();
                                            }


                                            $(itemsToDisplay).each(function (index, value) {

                                                $(value.validatingAirlineCodes).each(function (a, airlineCode) {
                                                    var airlineCodes = [];
                                                    airlineCodes.push(airlineCode);

                                                    $(value.itineraries).each(function (i, itinerary) {
                                                      




                                                        var durationValue = itinerary.duration;
                                                        var hour = durationValue.match(/(\d+)H/);
                                                        var minutes = durationValue.match(/(\d+)M/);
                                                        if (hour && minutes) {
                                                            var FormattedDuration = hour[1] + "hours" + "-" + minutes[1] + "minutes";
                                                        }
                                                            var segment = itinerary.segments;
                                                           
                                                             $(value.travelerPricings).each(function (j, pricing) {
                                                            for (let s = 0; s < itinerary.segments.length; s++) {
                                                            
                                                               


                                                                // Changing Arrival And Departure Format from yyyy-mm-dd 00-00 to mm-dd-yyyy
                                                                var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                                                //Departure Format
                                                                var DepartureDate = segment[s].departure.at;
                                                                var dept_date = new Date(DepartureDate);
                                                                var d_year = dept_date.getFullYear();
                                                                var d_month = dept_date.getMonth();
                                                                var d_date = dept_date.getDate();
                                                                var d_hour = dept_date.getHours();
                                                                var d_minutes = dept_date.getMinutes();
                                                                var FormattedDepatures = months[d_month] + ", " + d_date + "-" + d_year + "(" + d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour < 12 ? "AM" : "PM") + ")"; //  // for example Aug, 02-2017 (8:40 PM)
                                                                // Arrival Format
                                                                var segmentLast  = segment.splice(-1);
                                                                var ArrivalDate = segmentLast[s].arrival.at;
                                                               
                                                                var arr_date = new Date(ArrivalDate);
                                                             
                                                                var a_year = arr_date.getFullYear();
                                                                var a_month = arr_date.getMonth();
                                                                var a_date = arr_date.getDate();
                                                                var a_hour = arr_date.getHours();
                                                                var a_minutes = arr_date.getMinutes();
                                                               
                                                                var a_hour_12_format = a_hour % 12;
                                                                a_hour_12_format = a_hour_12_format ? a_hour_12_format : 12; // the hour '0' should be '12'
                                                                var FormattedArrival = months[a_month] + ", " + a_date + "-" + a_year + "(" + a_hour_12_format + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "PM" : "AM") + ")";
                                                                var wayType = "";
                                                                var stayType = "";
                                                                if (value.oneWay == false) {
                                                                    wayType = "Two Way";
                                                                    stayType = "2 Stay";
                                                                }
                                                                else {
                                                                    wayType = "One Way";
                                                                    stayType = "1 Stay";
                                                                }
                                                                var airlineData = {};


                                                                $.ajax({
                                                                    url: getAirlines,
                                                                    method: "Post",
                                                                    data: { AirlinesIata: airlineCodes },
                                                                    success: function (airlines) {
                                                                        var airlineInfo = {};

                                                                        $(airlines).each(function (ar, airline) {
                                                                            var departure_date = months[d_month] + ", " + d_date + "-" + d_year;
                                                                            var departure_time = d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour >= 12 ? "AM" : "PM");
                                                                            var arrival_date = months[a_month] + ", " + a_date + "-" + a_year;
                                                                            var arrival_time = a_hour + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "AM" : "PM");

                                                                            cardContainer += `
                                                                             <div class="list-block main-block f-list-block">
                                                                        <div class="list-content">
                                                                            <div class="main-img list-img f-list-img">
                                                                                <a href="flight-detail-left-sidebar.html">
                                                                                    <div class="f-img">
                                                                                                <img src="${airline.airlineImage}" class="img-fluid" alt="flight-img" />
                                                                                    </div><!-- end f-list-img -->
                                                                                </a>
                                                                                <ul class="list-unstyled list-inline offer-price-1">
                                                                                    <li class="list-inline-item duration"><i class="fa fa-clock-o"></i><span>${FormattedDuration}</span></li>
                                                                                            <li class="list-inline-item price"><div class="currencyContainer"></div>${pricing.price.total}<span class="divider">|</span><span class="pkg">${stayType}</span></li>
                                                                                </ul>
                                                                                <ul class="list-unstyled flight-timing">
                                                                                        <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedDepatures}</li>
                                                                                            <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedArrival}</li>
                                                                                </ul>
                                                                            </div><!-- end f-list-img -->

                                                                            <div class="list-info f-list-info">
                                                                                            <h3 class="block-title"><a href="flight-detail-left-sidebar.html">${FromCityName} to ${toCountryName}</a></h3>
                                                                                <p class="block-minor"><span>Fr 5379,</span> ${wayType} Flight</p>
                                                                                <p>Lorem ipsum dolor sit amet, ad duo fugit aeque fabulas, in lucilius prodesset pri. Veniam delectus ei vis. Est atqui timeam mnesarchum at, pro an eros perpetua ullamcorper.</p>

                                                                                    <form id="bookingFormDetails">
                                                                                            <input type ="hidden" name="airline_name" value="${airline.airlinename}" />
                                                                                            <input type ="hidden" name="airline_image" value="${airline.airlineImage}" />
                                                                                                    <input type ="hidden" name="aircraft_code" value="${segmentLast[s].aircraft.code}" />
                                                                                            <input type ="hidden" name="duration" value="${FormattedDuration}" />
                                                                                            <input type ="hidden" name="journey_type" value="${wayType}" />
                                                                                            <input type ="hidden" name="departure_date" value="${departure_date}" />
                                                                                            <input type ="hidden" name="departure_time" value="${departure_time}" />
                                                                                            <input type ="hidden" name="arrival_date" value="${arrival_date}" />
                                                                                            <input type ="hidden" name="arrival_time" value="${arrival_time}" />
                                                                                                <input type ="hidden" name="from" value="${FromCityName}" />
                                                                                            <input type ="hidden" name="to" value="${toCountryName}" />
                                                                                            <input type="hidden"  name="adults" value="${numberofAdults.val()}" />
                                                                                            <input type="hidden"  name="currency" value="${pricing.price.currency}" />
                                                                                            <input type="hidden"  name="price" value="${pricing.price.total}" />
                                                                                            <input type="hidden"  name="class_type" value="${pricing.fareDetailsBySegment[0].class}" />
                                                                                            <input type="hidden"  name="class_name" value="${pricing.fareDetailsBySegment[0].cabin}" />

                                                                                    <button type="submit" class="btn btn-orange ticket_booking">Book Ticket</button>
                                                                                        </form>
                                                                            </div><!-- end f-list-info -->
                                                                        </div><!-- end list-content -->
                                                                    </div><!-- end f-list-block -->`;
                                                                        });
                                                                        $(serviceContainer).html(cardContainer);
                                                                        $(airlineList).html(airlineContainer);
                                                                    }
                                                                });

                                                            }; //  Segemnts Ends Here
                                                        });  // Pricing Foreach Ends here
                                                    }); // Foreach Ends here

                                                }); // Foreach For Carrier Codes

                                            });// duration each function



                                        }

                                    }


                                });
                                $(document).on('click', '.ticket_booking', function (e) {
                                    e.preventDefault();
                                    var formData = {
                                        aircraftCode: $(this).closest('#bookingFormDetails').find('input[name="aircraft_code"]').val(),
                                        airlineName: $(this).closest('#bookingFormDetails').find('input[name="airline_name"]').val(),
                                        airlineImage: $(this).closest('#bookingFormDetails').find('input[name="airline_image"]').val(),
                                        duration: $(this).closest('#bookingFormDetails').find('input[name="duration"]').val(),
                                        departureTime: $(this).closest('#bookingFormDetails').find('input[name="departure_time"]').val(),
                                        departureDate: $(this).closest('#bookingFormDetails').find('input[name="departure_date"]').val(),
                                        arrivalTime: $(this).closest('#bookingFormDetails').find('input[name="arrival_time"]').val(),
                                        arrivalDate: $(this).closest('#bookingFormDetails').find('input[name="arrival_date"]').val(),
                                        class_name: $(this).closest('#bookingFormDetails').find('input[name="class_name"]').val(),
                                        class_type: $(this).closest('#bookingFormDetails').find('input[name="class_type"]').val(),
                                        from: $(this).closest('#bookingFormDetails').find('input[name="from"]').val(),
                                        to: $(this).closest('#bookingFormDetails').find('input[name="to"]').val(),
                                        number_of_adults: $(this).closest('#bookingFormDetails').find('input[name="adults"]').val(),
                                        journey_type: $(this).closest('#bookingFormDetails').find('input[name="journey_type"]').val(),
                                        price: $(this).closest('#bookingFormDetails').find('input[name="price"]').val(),
                                        currency: $(this).closest('#bookingFormDetails').find('input[name="currency"]').val()
                                    };

                                    window.location.href = FlightBookingUrl + '?FlightDetails=' + JSON.stringify(formData);
                                });
                            }

                        });

                    }
                    loadData();
                    $('#load-more').click(function () {


                        page++; // Increment the page number
                        cardContainer = ""; // Clear the cardContainer before loading more data
                        loadData();


                    });
                }
                else {
                    let FromCity = response.fromCityDetails.iataCode;
                    let FromCityName = response.fromCityDetails.city_name;
                    let toCityName = response.toCityDetails.city_name;
                    let toCity = response.toCityDetails.iataCode;
                    //Authorizing
                    var tokenUrl = "https://test.api.amadeus.com/v1/security/oauth2/token";
                    // Amadeus Client Credientals
                    const clientid = "gOIqKp00iu9rGRDRb893Mwa6YgagLRLz"; //Your App Api Key
                    const clientSecret = "86nyQTrv9AF5SkU4"; // Api Secret Key
                    //Creating A Data Variable to send these credentials
                    const requestData = {
                        grant_type: 'client_credentials',
                        client_id: clientid,
                        client_secret: clientSecret
                    };
                    //Converting Data Request to A url-encode String
                    const requestDataString = Object.keys(requestData).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(requestData[key])).join('&');
                    let itemsPerPage = 10;
                    let page = 1; // Page number
                    // Now Sending Ajax Request
                    let cardContainer = "";
                    function loadData() {
                        $.ajax({
                            url: tokenUrl,
                            method: 'Post',
                            data: requestDataString,
                            success: function (clientData) {
                                const apiUrl = 'https://test.api.amadeus.com/v2/shopping/flight-offers'; // The Api Service You Want Use
                                const accessToken = clientData.access_token; // This Is mendatory to authorize user to use the api service
                                const SearchParams = {

                                    originLocationCode: FromCity,
                                    destinationLocationCode: toCity,
                                    departureDate: formattedDeparture,// Date Format YYYY-MM-DD
                                    adults: numberofAdults.val()
                                }; // these are the params that we will send to our flight search api
                                const requestDataString = Object.keys(SearchParams).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(SearchParams[key])).join('&');
                                // Now Our Date And Uri is ready we will create a ajax Get request to send data and get data from response
                                $.ajax({
                                    url: apiUrl + '?' + requestDataString,
                                    method: "Get",
                                    headers: {
                                        'Authorization': 'Bearer ' + accessToken,
                                    },
                                    success: function (response) {
                                        if (response.data == "" || response.data == null) {
                                            Swal.fire({
                                                title: 'We Are Sorry!',
                                                text: 'No flights found!',
                                                icon: 'error',
                                                confirmButtonText: 'Close it!'
                                            });
                                            $(searchingLoader).fadeOut();
                                            $(errorContainer).fadeIn();
                                            $("#load-more").hide();
                                            return false;
                                        }
                                        else {
                                            let uniqueAirlinesIata = [];
                                            let segementArray = [];
                                            let airlineContainer = "";

                                            $.each(response.dictionaries.carriers, function (index, carriers) {
                                                airlineContainer += `
                                                        <li class="custom-check">
                                                                        <input type="checkbox" id="check${index}" name="checkbox" value="${carriers}"/>
                                                                    <label for="check${index}"><span><i class="fa fa-check"></i></span>${carriers}</label>
                                                        </li>`;
                                            });
                                            // Assuming 'response' is the JSON response object

                                            var airlineData = [];
                                            const startIndex = (page - 1) * itemsPerPage;

                                            const endIndex = startIndex + itemsPerPage;

                                            const itemsToDisplay = response.data.slice(startIndex, endIndex);

                                            if (itemsToDisplay.length >= 10) {
                                                $("#load-more").show();
                                                $("#load-more").prop("disabled", false);
                                            }
                                            else {
                                                $("#load-more").hide();
                                            }


                                            $(itemsToDisplay).each(function (index, value) {

                                                $(value.validatingAirlineCodes).each(function (a, airlineCode) {
                                                    var airlineCodes = [];
                                                    airlineCodes.push(airlineCode);

                                                    $(value.itineraries).each(function (i, itinerary) {





                                                        var durationValue = itinerary.duration;
                                                        var hour = durationValue.match(/(\d+)H/);
                                                        var minutes = durationValue.match(/(\d+)M/);
                                                        if (hour && minutes) {
                                                            var FormattedDuration = hour[1] + "hours" + "-" + minutes[1] + "minutes";
                                                        }
                                                        var segment = itinerary.segments;
                                                      
                                                        $(value.travelerPricings).each(function (j, pricing) {
                                                            for (let s = 0; s < itinerary.segments.length; s++) {




                                                                // Changing Arrival And Departure Format from yyyy-mm-dd 00-00 to mm-dd-yyyy
                                                                var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                                                //Departure Format
                                                                var DepartureDate = segment[s].departure.at;
                                                                var dept_date = new Date(DepartureDate);
                                                                var d_year = dept_date.getFullYear();
                                                                var d_month = dept_date.getMonth();
                                                                var d_date = dept_date.getDate();
                                                                var d_hour = dept_date.getHours();
                                                                var d_minutes = dept_date.getMinutes();
                                                                var FormattedDepatures = months[d_month] + ", " + d_date + "-" + d_year + "(" + d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour < 12 ? "AM" : "PM") + ")"; //  // for example Aug, 02-2017 (8:40 PM)
                                                                // Arrival Format
                                                                var segmentLast = segment.splice(-1);
                                                                var ArrivalDate = segmentLast[s].arrival.at;

                                                                var arr_date = new Date(ArrivalDate);

                                                                var a_year = arr_date.getFullYear();
                                                                var a_month = arr_date.getMonth();
                                                                var a_date = arr_date.getDate();
                                                                var a_hour = arr_date.getHours();
                                                                var a_minutes = arr_date.getMinutes();
                                                              
                                                                var a_hour_12_format = a_hour % 12;
                                                                a_hour_12_format = a_hour_12_format ? a_hour_12_format : 12; // the hour '0' should be '12'
                                                                var FormattedArrival = months[a_month] + ", " + a_date + "-" + a_year + "(" + a_hour_12_format + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "PM" : "AM") + ")";
                                                                var wayType = "";
                                                                var stayType = "";
                                                                if (value.oneWay == false) {
                                                                    wayType = "Two Way";
                                                                    stayType = "2 Stay";
                                                                }
                                                                else {
                                                                    wayType = "One Way";
                                                                    stayType = "1 Stay";
                                                                }
                                                                var airlineData = {};


                                                                $.ajax({
                                                                    url: getAirlines,
                                                                    method: "Post",
                                                                    data: { AirlinesIata: airlineCodes },
                                                                    success: function (airlines) {
                                                                        var airlineInfo = {};

                                                                        $(airlines).each(function (ar, airline) {
                                                                            var departure_date = months[d_month] + ", " + d_date + "-" + d_year;
                                                                            var departure_time = d_hour + ":" + (d_minutes < 10 ? '0' : '') + d_minutes + (d_hour >= 12 ? "AM" : "PM");
                                                                            var arrival_date = months[a_month] + ", " + a_date + "-" + a_year;
                                                                            var arrival_time = a_hour + ":" + (a_minutes < 10 ? '0' : '') + a_minutes + (a_hour >= 12 ? "AM" : "PM");

                                                                            cardContainer += `
                                                                                 <div class="list-block main-block f-list-block">
                                                                            <div class="list-content">
                                                                                <div class="main-img list-img f-list-img">
                                                                                    <a href="flight-detail-left-sidebar.html">
                                                                                        <div class="f-img">
                                                                                                    <img src="${airline.airlineImage}" class="img-fluid" alt="flight-img" />
                                                                                        </div><!-- end f-list-img -->
                                                                                    </a>
                                                                                    <ul class="list-unstyled list-inline offer-price-1">
                                                                                        <li class="list-inline-item duration"><i class="fa fa-clock-o"></i><span>${FormattedDuration}</span></li>
                                                                                                <li class="list-inline-item price"><div class="currencyContainer"></div>${pricing.price.total}<span class="divider">|</span><span class="pkg">${stayType}</span></li>
                                                                                    </ul>
                                                                                    <ul class="list-unstyled flight-timing">
                                                                                            <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedDepatures}</li>
                                                                                                <li><span><i class="fa fa-plane"></i></span><span class="date">${FormattedArrival}</li>
                                                                                    </ul>
                                                                                </div><!-- end f-list-img -->

                                                                                <div class="list-info f-list-info">
                                                                                                <h3 class="block-title"><a href="flight-detail-left-sidebar.html">${FromCityName} to ${toCountryName}</a></h3>
                                                                                    <p class="block-minor"><span>Fr 5379,</span> ${wayType} Flight</p>
                                                                                    <p>Lorem ipsum dolor sit amet, ad duo fugit aeque fabulas, in lucilius prodesset pri. Veniam delectus ei vis. Est atqui timeam mnesarchum at, pro an eros perpetua ullamcorper.</p>

                                                                                        <form id="bookingFormDetails">
                                                                                                <input type ="hidden" name="airline_name" value="${airline.airlinename}" />
                                                                                                <input type ="hidden" name="airline_image" value="${airline.airlineImage}" />
                                                                                                        <input type ="hidden" name="aircraft_code" value="${segmentLast[s].aircraft.code}" />
                                                                                                <input type ="hidden" name="duration" value="${FormattedDuration}" />
                                                                                                <input type ="hidden" name="journey_type" value="${wayType}" />
                                                                                                <input type ="hidden" name="departure_date" value="${departure_date}" />
                                                                                                <input type ="hidden" name="departure_time" value="${departure_time}" />
                                                                                                <input type ="hidden" name="arrival_date" value="${arrival_date}" />
                                                                                                <input type ="hidden" name="arrival_time" value="${arrival_time}" />
                                                                                                    <input type ="hidden" name="from" value="${FromCityName}" />
                                                                                                <input type ="hidden" name="to" value="${toCountryName}" />
                                                                                                <input type="hidden"  name="adults" value="${numberofAdults.val()}" />
                                                                                                <input type="hidden"  name="currency" value="${pricing.price.currency}" />
                                                                                                <input type="hidden"  name="price" value="${pricing.price.total}" />
                                                                                                <input type="hidden"  name="class_type" value="${pricing.fareDetailsBySegment[0].class}" />
                                                                                                <input type="hidden"  name="class_name" value="${pricing.fareDetailsBySegment[0].cabin}" />

                                                                                        <button type="submit" class="btn btn-orange ticket_booking">Book Ticket</button>
                                                                                            </form>
                                                                                </div><!-- end f-list-info -->
                                                                            </div><!-- end list-content -->
                                                                        </div><!-- end f-list-block -->`;
                                                                        });
                                                                        $(serviceContainer).html(cardContainer);
                                                                        $(airlineList).html(airlineContainer);
                                                                    }
                                                                });

                                                            }; //  Segemnts Ends Here
                                                        });  // Pricing Foreach Ends here
                                                    }); // Foreach Ends here

                                                }); // Foreach For Carrier Codes

                                            });// duration each function



                                        }

                                    }


                                });
                                $(document).on('click', '.ticket_booking', function (e) {
                                    e.preventDefault();
                                    var formData = {
                                        aircraftCode: $(this).closest('#bookingFormDetails').find('input[name="aircraft_code"]').val(),
                                        airlineName: $(this).closest('#bookingFormDetails').find('input[name="airline_name"]').val(),
                                        airlineImage: $(this).closest('#bookingFormDetails').find('input[name="airline_image"]').val(),
                                        duration: $(this).closest('#bookingFormDetails').find('input[name="duration"]').val(),
                                        departureTime: $(this).closest('#bookingFormDetails').find('input[name="departure_time"]').val(),
                                        departureDate: $(this).closest('#bookingFormDetails').find('input[name="departure_date"]').val(),
                                        arrivalTime: $(this).closest('#bookingFormDetails').find('input[name="arrival_time"]').val(),
                                        arrivalDate: $(this).closest('#bookingFormDetails').find('input[name="arrival_date"]').val(),
                                        class_name: $(this).closest('#bookingFormDetails').find('input[name="class_name"]').val(),
                                        class_type: $(this).closest('#bookingFormDetails').find('input[name="class_type"]').val(),
                                        from: $(this).closest('#bookingFormDetails').find('input[name="from"]').val(),
                                        to: $(this).closest('#bookingFormDetails').find('input[name="to"]').val(),
                                        number_of_adults: $(this).closest('#bookingFormDetails').find('input[name="adults"]').val(),
                                        journey_type: $(this).closest('#bookingFormDetails').find('input[name="journey_type"]').val(),
                                        price: $(this).closest('#bookingFormDetails').find('input[name="price"]').val(),
                                        currency: $(this).closest('#bookingFormDetails').find('input[name="currency"]').val()
                                    };

                                    window.location.href = FlightBookingUrl + '?FlightDetails=' + JSON.stringify(formData);
                                });
                            }

                        });

                    }
                    loadData();
                    $('#load-more').click(function () {


                        page++; // Increment the page number
                        cardContainer = ""; // Clear the cardContainer before loading more data
                        loadData();


                    });
                }

                // Now We Will Get Details From Flight Schedules Through Our Api Then Will Show the Airlines Results of avaialble Schedules


            }
        })



    });

</script>
